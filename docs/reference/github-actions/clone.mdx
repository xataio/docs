---
title: Xata Clone Workflow
description: GitHub Actions workflow for cloning databases on a schedule or on-demand
---

This workflow helps you clone your database on a schedule or manually trigger it. It's useful for creating regular backups or setting up test environments.

## Workflow Configuration

```yaml
name: Xata Clone (daily, on-demand)

on:
  schedule:
    - cron: "0 8 * * *"
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

env:
  FORCE_COLOR: 3
  XATA_API_REFRESH_TOKEN: ${{ secrets.XATA_API_REFRESH_TOKEN }}
  XATA_API_ENVIRONMENT: staging
  XATA_ORGANIZATIONID: 123xyz
  XATA_PROJECTID: prj_i3qsq56h3p3d3crnk7htnc75d0
  XATA_BRANCHID: s99l2grl6d3nr1cqcbaaa5piic
  XATA_BRANCHNAME: main
  XATA_DATABASENAME: app
  XATA_CLI_SOURCE_POSTGRES_URL: ${{ secrets.SOURCE_DATABASE_URL }}

jobs:
  xata-dev-branch:
    name: Xata Dev Branch
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          persist-credentials: false
      - name: Install Xata CLI
        run: |
          curl -fsSL https://xata.io/install.sh | bash
          echo "/home/runner/.config/xata/bin" >> $GITHUB_PATH

      - name: Check Xata Status
        run: |
          xata status
          xata branch view

      - name: Checkout Xata Dev Branch
        run: |
          echo XATA_BRANCHID=`xata branch checkout clone_demo --json | jq -r '.id'` >> $GITHUB_ENV

      - name: Check Xata Status
        run: |
          xata status
          xata branch view

      - name: Xata Clone
        run: |
          xata clone start --source-url ${{ env.XATA_CLI_SOURCE_POSTGRES_URL }}
```

## Authentication and Environment Variables

The workflow requires several environment variables to be set:

- `XATA_API_REFRESH_TOKEN`: Your Xata API refresh token (set as a GitHub secret)
- `XATA_API_ENVIRONMENT`: The Xata environment to use (e.g., staging)
- `XATA_ORGANIZATIONID`: Your Xata organization ID
- `XATA_PROJECTID`: Your Xata project ID
- `XATA_BRANCHID`: The ID of the main branch
- `XATA_BRANCHNAME`: The name of the main branch
- `XATA_DATABASENAME`: Your database name
- `XATA_CLI_SOURCE_POSTGRES_URL`: The source PostgreSQL database URL (set as a GitHub secret)

## Workflow Steps

### 1. Checkout Code

```yaml
- uses: actions/checkout@v4
  with:
    fetch-depth: 0
    persist-credentials: false
```

This step checks out your repository code with full history and proper credentials configuration.

### 2. Install Xata CLI

```yaml
- name: Install Xata CLI
  run: |
    curl -fsSL https://xata.io/install.sh | bash
    echo "/home/runner/.config/xata/bin" >> $GITHUB_PATH
```

This step installs the Xata CLI using the official installer script and adds it to the GitHub Actions PATH.

### 3. Check Xata Status

```yaml
- name: Check Xata Status
  run: |
    xata status
    xata branch view
```

This step verifies that your Xata CLI is properly configured and can connect to your database.

For more details, see:
- [status command documentation](../cli/status.mdx)
- [branch view command documentation](../cli/branch.mdx#view)

### 4. Checkout Clone Branch

```yaml
- name: Checkout Xata Dev Branch
  run: |
    echo XATA_BRANCHID=`xata branch checkout clone_demo --json | jq -r '.id'` >> $GITHUB_ENV
```

This step:
- Checks out the clone_demo branch
- Extracts the branch ID using `jq`
- Stores it in an environment variable

### 5. Start Clone Process

```yaml
- name: Xata Clone
  run: |
    xata clone start --source-url ${{ env.XATA_CLI_SOURCE_POSTGRES_URL }}
```

This step initiates the cloning process from your source PostgreSQL database.

For more details, see the [clone start command documentation](../cli/clone.mdx#start).

## Triggering the Workflow

The workflow can be triggered in two ways:

1. **Scheduled Run**
   ```yaml
   schedule:
     - cron: "0 8 * * *"
   ```
   Runs daily at 8:00 AM UTC

2. **Manual Trigger**
   ```yaml
   workflow_dispatch:
   ```
   Can be triggered manually from the GitHub Actions UI

## Concurrency Control

The workflow uses GitHub Actions concurrency to prevent multiple runs from interfering with each other:

```yaml
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true
```

This ensures that:
- Only one workflow run is active at a time
- New runs cancel any in-progress runs
- Prevents race conditions during cloning

## When to Use

Use this workflow when you want to:
- Create regular database backups
- Set up test environments
- Clone production data for development
- Maintain a separate clone of your database

## Best Practices

1. **Set Appropriate Timeout**
   - The workflow has a 10-minute timeout
   - Adjust based on your database size and cloning duration

2. **Use Environment Variables**
   - Store sensitive information in GitHub secrets
   - Use environment variables for configuration

3. **Schedule Regular Clones**
   - Set up a schedule that matches your backup needs
   - Consider your database size and update frequency

## Related Workflows

- [Check Workflow](./check.mdx) - For validating main branch status
- [PR Workflow](./pr.mdx) - For managing pull request environments 