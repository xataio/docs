---
title: Zero-downtime schema changes
description: Learn how to safely apply and roll back schema changes in Xata using the CLI.
---

This guide shows you how to safely apply and roll back schema changes in Xata using the CLI. You'll use the `xata roll` commands to manage migrations, and and example with additive and descructive changes to your database.

To better understand the use case and our novel approach to the challenge of schema changes, see the [schema changes core concept](/core-concepts/schema-changes) page for more details.

`xata roll` is embedding [pgroll](https://pgroll.com) behind the scenes and additional details around schema changes can be found in the [pgroll documentation](https://pgroll.com/docs/latest).

## 1. Prerequisites

- A Xata account ([sign up here](https://console.xata.io))
- The [Xata CLI](/cli) installed:
  ```bash
  curl -fsSL https://xata.io/install.sh | bash
  ```
- Access to your Xata PostgreSQL branch (connection string)
- An initialized Xata project and branch

## 2. Create a Xata project and branch

In the Console, create a new project and then click the **Create main branch** button to create the PostgreSQL instance.

![Create new branch](assets/images/create-new-branch.png)

Since this is a production setup, we recommend using at least 1 replica. It's a good idea to start with a similar instance size as you are running in your current PostgreSQL provider. You will be able to adjust it later.

## 3. Configure the Xata CLI

Authenticate the CLI by running:

```sh
xata auth login
```

Initialize the project by running:

```sh
xata init
```

You would typically run `xata init` command in your application source directory, or in any directory/repository where you'd like to keep the configuration. It will create a `.xata` folder with several configuration files.

Follow the instructions from the prompt to select the project and branch that you created at the previous step.

## 4. Prepare a migration directory

Create and initialize a directory for your migrations (e.g., `.xata/migrations`) using the following command:

```sh
xata roll init
```

This command sets up migration tracking on your current Xata branch and prepares the directory for your migration files.

## 5. Create initial tables

First, let's create some sample tables using the SQL from our [getting started guide](/getting-started). Connect to your database using psql:

```sh
psql `xata branch url`
```

Then run the following SQL:

```sql
CREATE TABLE products(id SERIAL PRIMARY KEY,name TEXT,price NUMERIC(7,2));
CREATE TABLE orders(id SERIAL PRIMARY KEY,created_at TIMESTAMPTZ DEFAULT now());
CREATE TABLE order_items(order_id INT REFERENCES orders(id),product_id INT REFERENCES products(id),qty INT,PRIMARY KEY(order_id,product_id));
INSERT INTO products(name,price) SELECT LEFT(md5(i::text),8),(random()*90+10)::numeric(7,2) FROM generate_series(1,10)i;
WITH o AS (INSERT INTO orders DEFAULT VALUES RETURNING id) INSERT INTO order_items(order_id,product_id,qty) SELECT o.id,pid,(1+floor(random()*3))::int FROM o,(SELECT id pid FROM products ORDER BY random() LIMIT 5)p;
```

## 6. Create a schema change migration

Now, let's create a migration to add a description column and remove the name column from the products table. Create a new file in your migrations directory (e.g., `.xata/migrations/001_alter_products.sql`) with the following content:

```sql
ALTER TABLE products ADD COLUMN description TEXT;
ALTER TABLE products DROP COLUMN name;
```

## 7. View and pull changes

You can view the changes in your branch details page in the [Xata Console](https://console.xata.io). The changes will be tracked automatically.

To pull the latest migrations locally, run:

```sh
xata roll pull
```

This will update your local migration files with any changes made to your database.

## 8. Apply the migration

You can apply migrations in two ways, depending on your needs:

### Option 1: One-step migration (migrate)

This is the simplest approach. The migration is applied and completed in a single command.

```sh
xata roll migrate
```

- This command applies all outstanding migrations and completes them immediately.
- Use this when you do not need to serve both schema versions to your application.

---

### Option 2: Two-step migration (start/complete)

This approach allows you to serve both the old and new schema versions to your application until you manually complete the migration, enabling zero-downtime cutovers and safer rollbacks.

#### 1. Start the migration

```sh
xata roll start
```

- This begins the migration and serves both schema versions.
- Your application can now read/write using either schema.

#### 2. (Optional) Roll back the migration

If you need to cancel the migration before completing it:

```sh
xata roll rollback
```

- This is only available while the migration is ongoing (after `start`, before `complete`).

#### 3. Complete the migration

```sh
xata roll complete
```

- This finalizes the migration, making the new schema the only active version.

## 9. Check migration status

See which migrations have been applied or are ongoing:

```sh
xata roll status
```

## 10. Add to CI/CD with GitHub Actions

To automate schema changes in your CI/CD pipeline, you can use our GitHub Actions workflow. This workflow creates a dedicated Xata branch for each pull request, allowing you to test database changes in isolation.

For details about setting up the workflow and available configuration options, see our [GitHub Actions PR workflow documentation](/github-actions/pr).

## 11. Summary

- Use `xata roll migrate` for simple, one-step migrations.
- Use `xata roll start` and `xata roll complete` for advanced, zero-downtime migrations, with the option to roll back while the migration is ongoing.
- For more advanced migration workflows, see the [pgroll deep dive tutorial](https://pgroll.com/docs/latest/tutorial).
- For more details on up/down migrations, see the [pgroll documentation](https://pgroll.com/docs/latest).
- See the [CLI reference](/cli/roll) for all available `xata roll` commands. 