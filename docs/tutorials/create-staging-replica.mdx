---
title: Set up staging replica
description: Use Xata's clone and branching features to create a safe, anonymized staging environment.
---

This guide shows you how to create a realistic staging environment in Xata by cloning your production database, optionally anonymizing sensitive data.

![Creating a staging replica of your prod database](assets/images/xata-deployment-staging.png)


## 1. Prerequisites

- A Xata account ([sign up here](https://console.xata.io))
- The Xata CLI installed:
  ```bash
  curl -fsSL https://xata.io/install.sh | bash
  ```
- Access to your production PostgreSQL database (connection string)

---

## 2. Clone your production database to Xata

We'll use the `xata clone` command to create a new `staging` branch in Xata, copying data from your production database and applying anonymization rules.

### a. Create and checkout the staging branch

If you haven't already, create and switch to the `staging` branch:

```bash
xata branch create staging
xata checkout staging
```

### b. Configure cloning

First, generate a configuration for the Xata clone process:

```bash
xata clone config --source-url 'postgres://user:pass@host:5432/prod_db' --mode prompt
```

Note: if your Postgres hosting provider uses self-signed certificates, you might can disable the strict certificate verification like this:

```bash
NODE_TLS_REJECT_UNAUTHORIZED=0 xata clone config --source-url 'postgres://user:pass@host:5432/prod_db' --mode prompt
```

Follow the prompts to specify whether you want anonymization enabled, which tables and columns to anonymize, and which transformers to use. For more details about transformers, see the [anonymization](/core-concepts/anonymization) page.

The result is a YAML configuration file written in `.xata/clone.yaml`. You can edit this file to further configure your anonymization process.

### c. Start the clone

Now, run the clone command to snapshot your production database into Xata:

```bash
xata clone start --source-url 'postgres://user:pass@host:5432/prod_db'
```

- The clone process will copy data and apply your anonymization rules to the current (staging) branch.

---

## 3. Create a development branch from staging

Now, list your branches to get the staging branch ID:

```bash
xata branch list
```

Grab the `staging` branch ID from the list and create a new `dev` branch from `staging`:

```bash
xata branch create --name dev --parent-branch [staging branch id]
```

Switch to your dev branch:

```bash
xata checkout dev
```

---

## Summary

- You now have a realistic, anonymized staging environment in Xata.
- You can safely test schema migrations, new indexes, or any other database changes using instant Copy-on-Write branches.

For more details on how to set up an advanced schema changes workflow, see the [schema changes](/core-concepts/schema-changes) section.
